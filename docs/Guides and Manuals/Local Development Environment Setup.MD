---
route: al-fc-setup
allow_guest: 1
published: 1
---

<div markdown="1"><p>This guide shows you how to setup your development machine for Frappe Cloud development. By the end of this guide, you will have a replica of the FC production environment.</p><blockquote><p>“Patience is bitter, but its fruit is sweet.” – Aristotle</p></blockquote><h2>Introduction</h2><p><code>f</code> servers: These host your bench (<code>f</code> is for Frappe Apps)</p><p><code>m</code> servers: These host the database (<code>m</code> is for MariaDB)</p><p><code>n</code> servers: These are proxy servers (<code>n</code> is Nginx, which does the proxying)</p><h2>Prerequisites</h2><h3>Softwares</h3><p>You should have the following software packages installed on your computer before proceeding:</p><ol><li><p>Docker: Latest, don't forget to give <code>docker</code> sudo access!</p></li><li><p>Certbot: Latest</p></li><li><p>dns-route53 plugin for certbot: <code>pip3 install certbot-dns-route53</code></p></li></ol><h3>Credentials from Frappe Assets</h3><p>You will need access to the following accounts. If you're working at Frappe, you can request them from <code>Frappe Assets</code> at frappe.io:</p><ol><li><p>Hetzner</p></li><li><p>Digital Ocean</p></li><li><p>AWS</p></li></ol><h2>Creating Servers on Hetzner</h2><p><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.hetzner.com/">Hetzner</a> is a cloud hosting provider that we will use to create our servers (<code>n</code>, <code>f</code> and <code>m</code>). In production, we use digital ocean but for development purposes, hetzner is a better value for money.</p><p>The naming convention used can be seen in the servers list:</p><p><code>&lt;server-type&gt;&lt;server-number&gt;.&lt;name-initial&gt;.fc.frappe.dev</code></p><p>For example, f1.g.fc.frappe.dev is the first <code>f</code> server and <code>g</code> is for Gavin.</p><p>Don't forget to add your default public SSH keys during server creation as internal ansible plays rely on default SSH keys.</p><p>Now, create 3 servers in <code>Helsinki</code> region and with <code>Ubuntu 20.04</code> OS:</p><ol><li><p><code>n1.&lt;unique-name-initial&gt;.fc.frappe.dev</code>: CX11 type.</p></li><li><p><code>f1.&lt;unique-name-initial&gt;.fc.frappe.dev</code>: CX21 type.</p></li><li><p><code>m1.&lt;unique-name-initial&gt;.fc.frappe.dev</code>: CX21 type.</p></li></ol><p>After the creation of the above mentioned servers, create a network resource and attach all the servers created above to that network resource.</p><p>Note down the IP Address of all the three servers.</p><h2>Creating DNS records in AWS Route53</h2><p>Go to the AWS Console (again, credentials are in Frappe Assets), navigate to <code>Route 53 &gt; Hosted Zones</code>. Click on <code>fc.frappe.dev</code> domain name. You have to create 4 DNS <code>A</code> records here. One record will be a wild-card sub-domain:</p><p><code>*.&lt;name-initial&gt;.fc.frappe.dev</code> pointing to the IP address of the <code>n</code> server created in the previous section.</p><p>The other 3 records will be for f1, n1 and m1 respectively. Use the IP address from the previous step. You can have a look at other such records if you get confused at any point.</p><p>Now, make sure you can <code>ssh</code> (as <code>root</code>) into all the three servers using thier domain names. For example:</p><pre><code>&gt; ssh root<span class="hljs-keyword">@f1</span>.h.fc.frappe.dev
<br class="ProseMirror-trailingBreak"></code></pre><h2>Create your site</h2><p>On your computer, run <code>bench get-app https://github.com/frappe/press</code>.</p><blockquote><p>If you are on a M series Mac computer and you get an error related to "go" when installing press. Here's what you can try:</p><ol><li><p>Install go binary - <code>brew install go</code></p></li><li><p><code>go env -w GO111MODULE=off</code></p></li></ol><p>After this, try running the get-app command again.</p></blockquote><p><br class="ProseMirror-trailingBreak"></p><p>Now, create a new site and install <code>press</code> on this site.</p><p>Open the site and login as Administrator.</p><h2>Press Settings</h2><h3>Create a <code>Root Domain</code></h3><p>Navigate to <code>Root Domain List</code> (AwesomeBar to rescue!) and create a new document. Fill up the details as below:</p><ul><li><p>Name: <code>&lt;your-domain-name&gt;</code>, e.g. <code>h.fc.frappe.dev</code></p></li><li><p>Default Cluster: <code>Default</code></p></li><li><p>AWS Access Key ID: Get from <code>AWS Console</code></p></li><li><p>AWS Secret Access Key: Get from <code>AWS Console</code></p></li></ul><p>Save it.</p><blockquote><p>You can get your Access Keys by going to AWS Console &gt; IAM &gt; User &gt; John Doe (create one if required) &gt; Security credentials &gt; Access Keys</p></blockquote><p>Open <code>Press Settings</code> now. Now, set the <code>Domain</code> to the root domain you created in the previous step and cluster to <code>Default</code>.</p><p>Now, there is going to be a lot of back and forth between your terminal and <code>Press Settings</code>, so sit tight.</p><h3>Let's Encrypt</h3><p>Scroll down and expand the <code>Let's Encrypt</code> section. Before entering the details here, you have to create two directories on your local computer (it is better to place this at user level, e.g. <code>/home/&lt;user&gt;/</code>):</p><ol><li><p><code>.certbot</code> -&gt; directory</p></li><li><p><code>webroot</code> -&gt; directory, inside the .certbot directory</p></li></ol><p>Now, fill the <code>Certbot Directory</code> and <code>Webroot Directory</code> with the absolute path of the above two newly created directories respectively. Leave out other fields as it is. You can enter your email if you want.</p><p>Save the settings.</p><h3>Docker</h3><p>Now, Scroll down to <code>Docker Registry</code> section.</p><p>Fill in the fields as given below:</p><p><code>Docker Registry URL</code>: registry.digitalocean.com/staging-frappe-cloud</p><p><code>Docker Registry Namespace</code>: Any name you like, e.g. <code>hussain-staging</code></p><p>Download Docker Credentials from https://cloud.digitalocean.com/registry/settings?i=abbd47 and then decode the auth string and use it for both <code>Docker Registry Username</code> and <code>Docker Registry Password</code></p><blockquote><p>The decoded string should be in the following format:</p><p><code>dop_v1_daaaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:dop_v1_daaaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code><br><br>Use the string before colon (:) as <code>Docker Registry Username</code> and <code>Docker Registry Password</code></p></blockquote><p>Again, save the settings and scroll down to <code>Docker Build</code> section.</p><p>Go to your terminal and <code>cd</code> into your <code>bench</code> directory. Create two directories here:</p><ol><li><p><code>.clones</code></p></li><li><p><code>.docker-builds</code></p></li></ol><p>Go back to the <code>Press Settings</code>and paste the absolute paths of the above two directories to the <code>Clone Directory</code> and <code>Build Directory</code> respectively. Leave the other field empty and save the settings.</p><p>Sometimes, there is an issue while uploading a docker image in the background and you have to manually <code>push</code> it to registry. For that case, you have to login to digital ocean registry through docker before pushing. You can do this by running this command:</p><pre><code>&gt; docker login -u &lt;<span class="hljs-keyword">do</span>-registry-user-id&gt; -p &lt;<span class="hljs-keyword">do</span>-password&gt; registry.digitalocean.com
<br class="ProseMirror-trailingBreak"></code></pre><h3>Stripe Settings</h3><p>In the Stripe Settings section, create a new Stripe Account from the link field.</p><p>You can signup for a new Stripe account from <a target="_blank" rel="noopener noreferrer nofollow" href="https://dashboard.stripe.com">https://dashboard.stripe.com/</a>. By default, Stripe gives you a test account which is enough for our development purposes.</p><p>Get the Publishable Key and Secret Key from Stripe dashboard and create your Stripe Account and set it in Press Settings. Set values for Credits on Signup fields. For e.g., INR 1800 and USD 25.</p><p>Now click on Create Stripe Webhook. It should create webhook endpoints on Stripe and set the field Stripe Webhook Endpoint ID.</p><p>That's it for Stripe Settings.</p><h2>Setting up Proxy server (<code>n</code> server)</h2><p>Go to the <code>Proxy Server</code> list and click <code>+ Add Proxy Server</code>. Fill in the details as given below:</p><p>Hostname: <code>n1</code> (<code>n2</code>, <code>n3</code>, if you want to create more Proxy servers)</p><p>IP: IP Address of the <code>n</code> server. Private IP: Private (internal) IP Address of the <code>n</code> server. Can be found in <code>Hetzner</code> console.</p><p>Click on save.</p><blockquote><p>Note: The agent password will be set automatically for you.</p></blockquote><p>Now, click on the <code>Actions</code> dropdown button, which is located next to the <code>Save</code> button and click on <code>Setup Server</code>. The server should go in <code>Installing</code> state.</p><p>This will setup the server. We use <code>Ansible</code> to automate the infrastructure, so, once you click on the <code>Setup Server</code> button, <code>Ansible Play</code>s will be created and run in the background to setup the server (install necessary software, perform essential configuration changes and more). Each <code>Ansible Play</code> document creates a number of <code>Ansible Task</code>, which is an individual task that will be carried out to setup the server.</p><p>Navigate to <code>Ansible Task List</code> and you should see some tasks which will have a particular status. For example, <code>success</code> means the task completed successfully and <code>running</code> means the task is currently running. You should confirm that all the tasks are eventually <code>success</code>ful.</p><p>After some time, when the tasks have completed to run, the <code>Proxy Server</code> will go to <code>Active</code> state.</p><p>If there is any error (for example, if the <code>Proxy Server</code> goes into <code>Broken</code> state) or a task keeps running forever, go to the <code>Error Log List</code> and you will most probably find a log that corresponds to the task and more information on why it failed.</p><blockquote><p>If the Ansible Task "Clone Agent Repository" fails, you might want to generate a personal access token and edit the git clone URL in <code>press/playbooks/roles/agent/tasks/main.yml</code> at the agent github URL line. It should be in the format: <code>"https://&lt;github-username&gt;:&lt;personal-access-token&gt;@github.com:/frappe/agent"</code></p></blockquote><h2>Setting up DB server (<code>m</code> server)</h2><p>In this section, we will move on to create a <code>Database Server</code>. Go to the <code>Database Server List</code> and create a new document. Fill in the fields as given below:</p><p>Hostname: <code>m1</code> IP: External IP address of the <code>m</code> server Private IP: Internal IP address of the <code>m</code> server</p><p>MariaDB Root Password: Create a password, this will be the <code>root</code> password of the MariaDB database that will be installed on this server.</p><p>Now, you have to follow the same steps as for the proxy server. Save the document and do setup server. Once this server is setup, you can move on to setting up the <code>f</code> server.</p><h2>Setting up App server (<code>f</code> server)</h2><p>In the proxy server section, we created and set up the <code>Proxy Server</code> which sits in the front and forwards traffic to various <code>f</code> servers. Now, <code>f</code> servers are where the benches (along with the sites) are present. The databases are on different <code>m</code> servers and the sites hosted in the <code>f</code> servers use those databases.</p><p>Go to the <code>Server List</code> and add a new server document. Fill in the details as given below:</p><p>Hostname: <code>f1</code> Cluster: <code>Default</code></p><p>IP: External IP address of <code>f</code> server Private IP: Internal IP address of <code>f</code> server</p><p>Proxy Server: Select the <code>Proxy Server</code> which we created in a previous section. Database Server: Select the <code>Database Server</code> which we created in the previous section.</p><p>Leave other fields as they are. Save the document.</p><p>Now, click on Actions &gt; Setup Server and wait for it to complete. After that, click on Actions &gt; Add to Proxy.</p><p>That's it for the <code>f</code> server.</p><h2>Setting up Builds</h2><p>Under <strong>Press Settings</strong> &gt; <strong>Docker</strong> &gt; <strong>Docker Build</strong> set <strong>Build Server</strong> to the app server you have created in the previous set.</p><p>Now, when you run a <em>Build and Deploy</em>, the image that is created for the deployment will be built on the Build Server.<br><br class="ProseMirror-trailingBreak"></p><blockquote><p><strong>Note</strong>: You need to add <strong>sync</strong> and <strong>build</strong> queue, in your common_site_config.json <a target="_blank" rel="noopener noreferrer nofollow" href="https://github.com/frappe/press/blob/78a736c0acefcfce7d74767620688de5f7a2d059/deployment/common_site_config.json#L28"><strong>Ref</strong></a></p><pre><code>  <span class="hljs-attr">"workers":</span> {
    <span class="hljs-attr">"sync":</span> {
      <span class="hljs-attr">"timeout":</span> <span class="hljs-number">300</span>
    },
    <span class="hljs-attr">"build":</span> {
      <span class="hljs-attr">"timeout":</span> <span class="hljs-number">2400</span>
    }
  }</code></pre></blockquote><p><br class="ProseMirror-trailingBreak"></p><h2>Creating Your First Site</h2><h3>Creating an App</h3><p>The first step is to create an App that will ultimately be installed on our site. The first app in any release group must be <code>frappe</code> (Frappe Framework), the name is case sensitive. Navigate to <code>App List</code> page and click on <code>'+ Add new App'</code> button on the top-right corner. Fill in the details as below:</p><p><img class="screenshot" src="../files/new_app.png" alt="New App" contenteditable="false" draggable="true"><img class="ProseMirror-separator" alt=""><br class="ProseMirror-trailingBreak"></p><h3>Create App Source</h3><p>Now, we need to create an App source for this app. Navigate to <code>App Source</code> list page, create a new document and fill in the details as below:</p><p><img class="screenshot" src="../files/aBnJbGp.png" alt="" contenteditable="false" draggable="true"><img class="ProseMirror-separator" alt=""><br class="ProseMirror-trailingBreak"></p><h3>Creating a Release Group</h3><blockquote><p>If you are on a Mac add <code>export NO_PROXY=* OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES</code> to your shell configuration file (like .zshrc) to avoid having <code>Agent Jobs</code> stuck at <code>Undelivered</code> status.</p></blockquote><p>Navigate to the <code>Release Group</code> list and create a new release group. The details to be filled are shown in the screenshot below.</p><p><img class="screenshot" src="../files/new_release_group.png" alt="New App" contenteditable="false" draggable="true"><img class="ProseMirror-separator" alt=""><br class="ProseMirror-trailingBreak"></p><p>Select the app source that you created in the previous step. Click save.</p><p>Once you save the release group document, a <code>Deploy Candidate</code> is automatically created for this release group. In fact, a deploy candidate is created any time you make changes to the <code>Release Group</code>.</p><p><img class="screenshot" src="../files/release_group_saved.png" alt="New App" contenteditable="false" draggable="true"><img class="ProseMirror-separator" alt=""><br class="ProseMirror-trailingBreak"></p><p>Click on the <code>Deploy Candidate</code> chip and this will take you to the <code>Deploy Candidate</code> page which is filtered for the current <code>Release Group</code>. Select the <code>Deploy Candidate</code> (are named like <code>bench-xxx</code>) that was created latest. You should only have one if you never created a release group before. Now, click on <code>Actions</code> and then <code>Schedule Build and Deploy</code>.</p><p><img class="screenshot" src="../files/deploy_candidate.png" alt="New App" contenteditable="false" draggable="true"><img class="ProseMirror-separator" alt=""><br class="ProseMirror-trailingBreak"></p><p>This will build the docker image for this bench group, upload it to the digital ocean image registry and also deploy it to your <code>f</code> server.</p><p>You can click on <code>Visit Dashboard</code> link on the top-left corner to view the progress of the build and deploy step.</p><p>Once the image is deployed, you can go the bench list and you will find a new bench there. This was created using the <code>Deploy Candidate</code>. Now, you can go ahead and create as many sites you want. You can do this either via the dashboad or the desk.</p><h2>Resolving issues</h2><p>One of the issues that you may get into is not being able to obtain a TLS Certificate for the root domain. If that is the case, you have to manually call (via <code>console</code>) the <code>_obtain_certificate</code> method on the <code>TLS Certificate</code> document that was created for the <code>Root Domain</code> document that we created in the initial part of this guide.</p><h2>Tips</h2><ul><li><p>Set <code>scheduler_tick_interval</code> to a smaller value (like 5) for faster Agent Job updates, since most of them don't take much time.</p></li></ul><h2>Conclusion</h2><p>If you made till here, well done and be proud of yourself. Now, its time to build awesome things. Good Luck with your journey on Frappe Cloud.</p></div>